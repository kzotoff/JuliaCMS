<?php/*CMS login/logout routines. Note that it doesn't intersect auth module*/define('SECURUTY_LOGIN_HTML_FULL', <<<HTML<!doctype html><html lang="en"><head>	<meta charset="UTF-8">	<title>Login</title>	<style type="text/css">		html, body, table { height: 100%; width: 100%; margin: 0px; padding: 0px; }		body { font-family: verdana; font-size: 16px; }	</style></head><body><table><tr><td></td><td style="width:20em;"><form action="./" method="post"><input type="hidden" name="action" value="checklogin" /><table>	<tr><td style="text-align: right;">Login</td><td><input type="text" name="userlogin" autofocus="autofocus" /></td></tr>	<tr><td style="text-align: right;">Password</td><td><input type="password" name="userpassword" /></td></tr>	<tr><td colspan="2" style="height: 1em;"></td></tr>	<tr><td colspan="2" style="text-align: center;"><input type="submit" value="Go" style="width: 5em;" /></td></tr></table></form></td><td></td></tr></table></body></html>HTML);// калитка для ленивых - отслеживает поиск по строке "login" и перенаправляет на страницу логинаif (isset($_GET['search']) && ($_GET['search'] == 'login')) {	header('Location: ./?login');	terminate();}// если запрошен логин (в URI есть параметр "login"), выводим страницу логинаif (isset($_GET['login']) && (!isset($_SESSION['CMS_AUTH_USER']) || ($_SESSION['CMS_AUTH_USER'] == ''))) {	// вместо шаблона возвращаем страницу логина	echo SECURUTY_LOGIN_HTML_FULL;	terminate();}// если прислали логин/пароль, проверим данныеif (isset($_POST['action']) && ($_POST['action'] == 'checklogin')) {	if ((@$_POST['userlogin'] == 'admin') && (@$_POST['userpassword'] == SECURITY_ADMIN_PASSWORD)) {		$_SESSION['CMS_AUTH_USER'] = 'admin';	}}// выходif (isset($_GET['logout'])) {	$_SESSION['CMS_AUTH_USER'] = '';	/*		// erase all cookies	if (ini_get('session.use_cookies')) {		$params = session_get_cookie_params();		setcookie(session_name(), '', time() - 42000, $params['path'], $params['domain'], $params['secure'], $params['httponly']);		}	session_destroy();*/	header('location: ./');	terminate();}// основная функция - проверка права пользователя делать то или иное действиеfunction user_allowed_to($action) {	$username = isset($_SESSION['CMS_AUTH_USER']) ? $_SESSION['CMS_AUTH_USER'] : '';		// одмину можно все	if ($username == 'admin') {		return true;	}}?>